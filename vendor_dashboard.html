<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vendor Dashboard | StreetBasket</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Navbar -->
  <nav class="bg-green-700 text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-semibold">StreetBasket - Vendor Dashboard</h1>
    <a href="{{ url_for('vendor_logout') }}" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">Logout</a>
  </nav>

  <main class="max-w-6xl mx-auto p-6 flex-grow">

    <!-- Greeting -->
    <header class="mb-8">
      <h2 class="text-3xl font-bold mb-1">Welcome, {{ vendor.name }}</h2>
      <p class="text-gray-700">Location: {{ vendor.location }}</p>
    </header>

    <!-- Add New Product Button -->
    <a href="{{ url_for('product_upload') }}" class="inline-block bg-green-700 hover:bg-green-800 text-white px-5 py-3 rounded mb-8">
      + Add New Product
    </a>

    <!-- Search/filter form -->
    <form method="GET" action="{{ url_for('vendor_dashboard') }}" class="mb-6 space-y-4">
      <input
        type="text"
        name="search"
        placeholder="Search products..."
        value="{{ search_query }}"
        class="border p-2 rounded w-full md:w-1/3"
      />

      <div class="flex flex-wrap gap-4 items-center">
        <input
          type="number"
          name="price_min"
          placeholder="Min Price"
          min="0"
          step="0.01"
          value="{{ price_min if price_min is not none else '' }}"
          class="border p-2 rounded w-24"
        />

        <input
          type="number"
          name="price_max"
          placeholder="Max Price"
          min="0"
          step="0.01"
          value="{{ price_max if price_max is not none else '' }}"
          class="border p-2 rounded w-24"
        />

        <select name="stock_filter" class="border p-2 rounded w-40">
          <option value="" {% if not stock_filter %}selected{% endif %}>All Stock</option>
          <option value="in_stock" {% if stock_filter == 'in_stock' %}selected{% endif %}>In Stock</option>
          <option value="out_of_stock" {% if stock_filter == 'out_of_stock' %}selected{% endif %}>Out of Stock</option>
        </select>

        <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800">Filter</button>
        <a href="{{ url_for('vendor_dashboard') }}" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Reset</a>
      </div>
    </form>

    <!-- Products List -->
    <section class="mb-12">
      <h3 class="text-2xl font-semibold mb-4">Your Products</h3>
      {% if products %}
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {% for product in products %}
            <div class="bg-white rounded-lg shadow p-4 relative">
              <h4 class="font-semibold text-lg mb-2">
                {% if search_query %}
                  {{ product.name | highlight_search(search_query)|safe }}
                {% else %}
                  {{ product.name }}
                {% endif %}
              </h4>
              <p class="text-gray-700 mb-1">Price: ₹{{ product.price }} per kg</p>
              <p class="text-gray-700 mb-1">Stock: {{ product.stock }} kg</p>
              {% if product.image_filename %}
                <img src="{{ url_for('static', filename='uploads/' + product.image_filename) }}" alt="{{ product.name }}" class="mt-2 max-h-32 object-contain mx-auto">
              {% endif %}
              <div class="mt-4 flex space-x-2">
                <a href="{{ url_for('edit_product', product_id=product.id) }}" class="bg-yellow-400 hover:bg-yellow-500 px-3 py-1 rounded text-white">Edit</a>
                <form action="{{ url_for('delete_product', product_id=product.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this product?');">
                  <button type="submit" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white">Delete</button>
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p>No products available currently.</p>
      {% endif %}

      <!-- Pagination Controls -->
      <div class="flex justify-center space-x-2 mt-8">
        {% if pagination.has_prev %}
          <a href="{{ url_for('vendor_dashboard', page=pagination.prev_num, search=search_query, price_min=price_min, price_max=price_max, stock_filter=stock_filter) }}" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Previous</a>
        {% else %}
          <span class="px-4 py-2 bg-gray-300 text-gray-600 rounded cursor-not-allowed">Previous</span>
        {% endif %}

        <span class="px-4 py-2 bg-gray-200 text-gray-800 rounded">Page {{ pagination.page }} of {{ pagination.pages }}</span>

        {% if pagination.has_next %}
          <a href="{{ url_for('vendor_dashboard', page=pagination.next_num, search=search_query, price_min=price_min, price_max=price_max, stock_filter=stock_filter) }}" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Next</a>
        {% else %}
          <span class="px-4 py-2 bg-gray-300 text-gray-600 rounded cursor-not-allowed">Next</span>
        {% endif %}
      </div>
    </section>

    <!-- Orders Table -->
    <section>
      <h3 class="text-2xl font-semibold mb-4">Your Orders</h3>
      {% if orders %}
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white rounded shadow">
            <thead>
              <tr class="bg-green-700 text-white text-left">
                <th class="py-2 px-4">Product</th>
                <th class="py-2 px-4">Quantity</th>
                <th class="py-2 px-4">Total Price</th>
                <th class="py-2 px-4">Status</th>
                <th class="py-2 px-4">Ordered On</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
                <tr class="border-b">
                  <td class="py-2 px-4">{{ order.product.name }}</td>
                  <td class="py-2 px-4">{{ order.quantity }}</td>
                  <td class="py-2 px-4">₹{{ (order.quantity * order.product.price) | round(2) }}</td>
                  <td class="py-2 px-4">{{ order.status }}</td>
                  <td class="py-2 px-4">{{ order.order_date.strftime('%Y-%m-%d') if order.order_date else 'N/A' }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p>You have not placed any orders yet.</p>
      {% endif %}
    </section>
  </main>
</body>
</html>
